# -*- coding: utf-8 -*-
"""SegundaMedida_Crossplane.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1XwXVWqI4gqIJyrUyEdMQU56Wb87-gOun
"""

import pandas as pd
import matplotlib.pyplot as plt
from io import StringIO
import numpy as np
from scipy.interpolate import interp1d

# Función para calcular FWHM (Full Width Half Maximum)
def calcular_fwhm(posicion, dosis):
    max_dosis = max(dosis)
    half_max_dosis = max_dosis / 2

    # Interpolar los datos para encontrar el FWHM con mayor precisión
    interp_func = interp1d(posicion, dosis)

    # Encontrar posiciones a la mitad de la dosis máxima
    posiciones_half_max = np.where(dosis >= half_max_dosis)[0]

    if len(posiciones_half_max) > 1:
        fwhm = abs(posicion[posiciones_half_max[-1]] - posicion[posiciones_half_max[0]])
        return fwhm
    else:
        return None

# Función corregida para calcular la simetría y planitud
def calcular_simetria_planitud(posicion, dosis):
    # Simetría: Compara la dosis a ambos lados del eje central (posicion 0)
    indice_central = np.argmin(np.abs(posicion))  # Encuentra el índice más cercano a 0 (eje central)
    dosis_central = dosis[indice_central]

    izquierda = dosis[:indice_central]
    derecha = dosis[indice_central+1:][::-1]  # Invertir la parte derecha para comparar con la izquierda

    # Asegurarnos de que las dos partes tengan la misma longitud
    if len(izquierda) > len(derecha):
        izquierda = izquierda[:len(derecha)]
    elif len(derecha) > len(izquierda):
        derecha = derecha[:len(izquierda)]

    simetria = np.mean(np.abs(izquierda - derecha) / dosis_central) * 100  # Error relativo porcentual

    # Planitud: Variación dentro del área entre el 80% y 100% de la dosis máxima
    max_dosis = max(dosis)
    limite_inferior = 0.8 * max_dosis

    # Filtrar la región de interés (dosis >= 80% de la dosis máxima)
    indices_region = np.where(dosis >= limite_inferior)[0]

    if len(indices_region) > 0:
        dosis_region = dosis[indices_region]
        max_region = max(dosis_region)
        min_region = min(dosis_region)
        planitud = (max_region - min_region) / (max_region + min_region) * 100
    else:
        planitud = None

    return simetria, planitud

""" Data = cm, cGy """

p4datos = """

-3.9099,0
-3.874,0
-3.8382,0
-3.8024,0
-3.7665,0
-3.7307,0
-3.6949,0
-3.659,0
-3.6232,0
-3.5874,0
-3.5515,0
-3.5157,0
-3.4799,23.512
-3.444,25.0408
-3.4082,26.9134
-3.3724,26.9134
-3.3365,28.5387
-3.3007,29.9051
-3.2648,31.1288
-3.229,32.575
-3.1932,33.638
-3.1573,34.1663
-3.1215,35.1765
-3.0857,35.7416
-3.0498,36.3644
-3.014,36.7808
-2.9782,37.3949
-2.9423,37.8899
-2.9065,38.5516
-2.8707,38.7902
-2.8348,39.0775
-2.799,39.2274
-2.7632,39.5112
-2.7273,40.0879
-2.6915,40.3401
-2.6557,40.4622
-2.6198,40.5762
-2.584,40.5762
-2.5482,40.6007
-2.5123,40.6659
-2.4765,40.7433
-2.4407,40.9104
-2.4048,40.9389
-2.369,40.9797
-2.3332,41.1919
-2.2973,41.3593
-2.2615,41.3552
-2.2257,41.3878
-2.1898,41.3919
-2.154,41.6943
-2.1182,41.7883
-2.0823,41.7883
-2.0465,41.7883
-2.0107,41.7801
-1.9748,41.4695
-1.939,41.4614
-1.9032,41.4328
-1.8673,41.4123
-1.8315,41.4001
-1.7957,41.4001
-1.7598,41.3674
-1.724,41.249
-1.6882,41.1633
-1.6523,41.0899
-1.6165,41.0654
-1.5807,41.0654
-1.5448,41.1266
-1.509,41.0776
-1.4732,41.1266
-1.4373,41.1266
-1.4015,41.1429
-1.3656,41.0817
-1.3298,41.0735
-1.294,40.7922
-1.2581,40.6577
-1.2223,40.4704
-1.1865,40.3279
-1.1506,40.271
-1.1148,40.1367
-1.079,40.2506
-1.0431,40.2587
-1.0073,40.2832
-0.97148,40.2913
-0.93564,40.4337
-0.89981,40.45
-0.86397,40.4582
-0.82814,40.4867
-0.79231,40.5844
-0.75647,40.5803
-0.72064,40.6251
-0.6848,40.6251
-0.64897,40.7677
-0.61314,40.7718
-0.5773,40.7881
-0.54147,40.7718
-0.50563,40.7677
-0.4698,40.5396
-0.43397,40.4907
-0.39813,40.4459
-0.3623,40.4215
-0.32646,40.4459
-0.29063,40.4215
-0.2548,40.3808
-0.21896,40.393
-0.18313,40.3808
-0.1473,40.2669
-0.11146,40.2913
-0.075627,40.2913
-0.039793,40.2913
-0.0039593,40.3727
0.031875,40.4378
0.067709,40.4378
0.10354,40.393
0.13938,40.2425
0.17521,40.1449
0.21104,40.0635
0.24688,39.9904
0.28271,39.7385
0.31855,39.7142
0.35438,39.7142
0.39021,39.6614
0.42605,39.633
0.46188,39.633
0.49772,39.6492
0.53355,39.6289
0.56938,39.5559
0.60522,39.5234
0.64105,39.4017
0.67689,39.3288
0.71272,39.2355
0.74855,39.3288
0.78439,39.3612
0.82022,39.2923
0.85606,39.272
0.89189,39.2436
0.92772,39.1221
0.96356,38.9966
0.99939,38.9682
1.0352,38.7861
1.0711,38.7861
1.1069,38.7093
1.1427,38.6123
1.1786,38.4022
1.2144,38.1398
1.2502,37.9866
1.2861,37.8416
1.3219,37.7328
1.3577,37.7248
1.3936,37.7489
1.4294,37.7489
1.4652,37.8536
1.5011,37.8738
1.5369,37.906
1.5727,37.9624
1.6086,38.0068
1.6444,38.0068
1.6802,38.0753
1.7161,38.1197
1.7519,38.1197
1.7877,38.2891
1.8236,38.3416
1.8594,38.2891
1.8952,38.3376
1.9311,38.4466
1.9669,38.378
2.0027,38.4506
2.0386,38.3376
2.0744,38.2084
2.1102,38.0995
2.1461,38.0431
2.1819,38.035
2.2177,38.0431
2.2536,38.0632
2.2894,38.0632
2.3252,38.0713
2.3611,38.4103
2.3969,38.4224
2.4327,38.4789
2.4686,38.4789
2.5044,38.4789
2.5403,38.3901
2.5761,38.2326
2.6119,38.0632
2.6478,37.9907
2.6836,37.9302
2.7194,37.8335
2.7553,37.6724
2.7911,37.6724
2.8269,37.5759
2.8628,37.4834
2.8986,37.3386
2.9344,37.3386
2.9703,37.3226
3.0061,37.3226
3.0419,37.3145
3.0778,37.0976
3.1136,36.8289
3.1494,36.5005
3.1853,36.2285
3.2211,35.8413
3.2569,35.2083
3.2928,34.8351
3.3286,33.8625
3.3644,33.3352
3.4003,32.8293
3.4361,31.1597
3.4719,0.26953
3.5078,0
3.5436,0
3.5794,0
3.6153,0
3.6511,0
3.6869,0
3.7228,0
3.7586,0
3.7944,0
3.8303,0
3.8661,0
3.9019,0
3.9378,0
3.9736,0
4.0094,0
4.0453,0
4.0811,0


"""

p3datos = """

-4.1631,0
-4.1273,0
-4.0915,0
-4.0556,0
-4.0198,0
-3.984,0
-3.9481,0
-3.9123,0
-3.8765,0
-3.8406,0
-3.8048,0
-3.769,0
-3.7331,0
-3.6973,0
-3.6615,0
-3.6256,0
-3.5898,0
-3.554,110.6003
-3.5181,151.0817
-3.4823,164.7805
-3.4465,176.8463
-3.4106,188.679
-3.3748,200.0208
-3.339,212.9705
-3.3031,223.0058
-3.2673,232.6393
-3.2315,246.6515
-3.1956,255.4268
-3.1598,270.6159
-3.124,279.2334
-3.0881,285.6629
-3.0523,289.5755
-3.0165,295.1203
-2.9806,299.1483
-2.9448,302.8555
-2.909,306.8466
-2.8731,310.0528
-2.8373,313.7246
-2.8014,318.1579
-2.7656,322.3822
-2.7298,326.1207
-2.6939,331.4991
-2.6581,339.8062
-2.6223,343.4329
-2.5864,348.8772
-2.5506,351.9239
-2.5148,356.1117
-2.4789,357.3341
-2.4431,359.9958
-2.4073,361.1743
-2.3714,362.5566
-2.3356,364.8783
-2.2998,366.7202
-2.2639,366.7896
-2.2281,368.6231
-2.1923,371.394
-2.1564,372.59
-2.1206,374.7968
-2.0848,377.8338
-2.0489,379.3377
-2.0131,384.1657
-1.9773,385.3049
-1.9414,386.7743
-1.9056,386.8561
-1.8698,387.8379
-1.8339,387.8379
-1.7981,389.7226
-1.7623,392.3453
-1.7264,393.082
-1.6906,393.3274
-1.6548,396.6681
-1.6189,398.366
-1.5831,399.5713
-1.5473,399.5713
-1.5114,399.5713
-1.4756,398.9293
-1.4398,397.8013
-1.4039,396.9923
-1.3681,397.7205
-1.3323,397.7205
-1.2964,396.587
-1.2606,396.9113
-1.2248,394.8789
-1.1889,395.2863
-1.1531,395.2863
-1.1173,396.8303
-1.0814,396.8303
-1.0456,396.8303
-1.0098,396.8303
-0.97392,397.1543
-0.93808,397.1543
-0.90225,397.9627
-0.86642,398.1241
-0.83058,398.1241
-0.79475,397.9627
-0.75891,397.9627
-0.72308,396.0998
-0.68725,394.7974
-0.65141,394.3079
-0.61558,394.3079
-0.57974,394.3895
-0.54391,396.4247
-0.50808,396.4247
-0.47224,396.9113
-0.43641,395.2863
-0.40057,395.0419
-0.36474,394.9604
-0.32891,393.0002
-0.29307,391.772
-0.25724,391.2803
-0.2214,391.2803
-0.18557,391.2803
-0.14974,391.2803
-0.1139,390.5425
-0.078069,390.5425
-0.042235,390.1326
-0.0064008,390.1326
0.029433,389.6406
0.065267,390.3785
0.1011,392.3453
0.13694,394.2262
0.17277,396.0186
0.2086,397.1543
0.24444,397.6397
0.28027,397.6397
0.3161,398.7685
0.35194,401.7221
0.38777,401.8803
0.42361,401.4845
0.45944,399.2506
0.49527,398.6076
0.53111,397.9627
0.56694,397.0733
0.60278,396.3435
0.63861,396.5058
0.67444,396.0186
0.71028,393.082
0.74611,390.1326
0.78195,387.9198
0.81778,386.6926
0.85361,386.6926
0.88945,387.9198
0.92528,387.9198
0.96112,387.9198
0.99695,387.6742
1.0328,387.6742
1.0686,384.0844
1.1045,383.0304
1.1403,384.0844
1.1761,385.7126
1.212,385.7126
1.2478,387.1014
1.2836,388.3293
1.3195,388.4113
1.3553,389.3127
1.3911,389.9686
1.427,389.3127
1.4628,389.1488
1.4986,389.1488
1.5345,388.3293
1.5703,386.3657
1.6061,387.0196
1.642,386.1207
1.6778,385.0605
1.7136,385.5495
1.7495,385.5495
1.7853,381.7388
1.8211,381.0957
1.857,381.0957
1.8928,380.7749
1.9286,380.7749
1.9645,379.5765
2.0003,379.4173
2.0361,377.1267
2.072,374.3363
2.1078,372.0648
2.1436,368.6231
2.1795,368.5516
2.2153,366.4433
2.2511,361.3056
2.287,361.3056
2.3228,362.1609
2.3586,361.0431
2.3945,359.8653
2.4303,356.3685
2.4661,352.6784
2.502,350.6737
2.5378,347.7111
2.5736,345.5258
2.6095,343.7894
2.6453,339.8639
2.6811,336.6805
2.717,333.9723
2.7528,329.3537
2.7886,326.0713
2.8245,319.1677
2.8603,315.6325
2.8961,311.627
2.932,308.5483
2.9678,304.8847
3.0037,302.2474
3.0395,294.9838
3.0753,289.6436
3.1112,279.3066
3.147,267.2649
3.1828,257.304
3.2187,244.5942
3.2545,227.1278
3.2903,222.0492
3.3262,217.3932
3.362,159.9154
3.3978,0
3.4337,0
3.4695,0
3.5053,0
3.5412,0
3.577,0
3.6128,0
3.6487,0
3.6845,0
3.7203,0
3.7562,0
3.792,0
3.8278,0


"""


p2datos = """

-4.0899,0
-4.0541,0
-4.0183,0
-3.9824,0
-3.9466,0
-3.9108,0
-3.8749,0
-3.8391,0
-3.8033,0
-3.7674,0
-3.7316,0
-3.6958,0
-3.6599,0
-3.6241,0
-3.5883,0
-3.5524,49.894
-3.5166,195.516
-3.4808,227.0385
-3.4449,264.0106
-3.4091,293.8935
-3.3733,319.2562
-3.3374,345.2249
-3.3016,377.4405
-3.2658,411.3603
-3.2299,438.1712
-3.1941,455.7487
-3.1583,479.7652
-3.1224,504.8836
-3.0866,521.0115
-3.0508,537.976
-3.0149,549.2304
-2.9791,561.8409
-2.9433,567.1474
-2.9074,572.9431
-2.8716,578.59
-2.8358,582.2484
-2.7999,589.8311
-2.7641,602.4466
-2.7283,611.9516
-2.6924,623.4624
-2.6566,635.1698
-2.6208,647.2293
-2.5849,658.1226
-2.5491,659.2432
-2.5132,660.8476
-2.4774,664.2467
-2.4416,670.0858
-2.4057,675.7378
-2.3699,680.4473
-2.3341,688.5091
-2.2982,693.2633
-2.2624,699.4523
-2.2266,702.8875
-2.1907,703.8788
-2.1549,708.1273
-2.1191,711.6532
-2.0832,712.41
-2.0474,713.167
-2.0116,715.9405
-1.9757,716.444
-1.9399,718.7045
-1.9041,718.7045
-1.8682,718.955
-1.8324,726.3691
-1.7966,731.1626
-1.7607,733.5298
-1.7249,732.8211
-1.6891,733.0575
-1.6532,733.0575
-1.6174,733.0575
-1.5816,729.9733
-1.5457,734.4728
-1.5099,741.7315
-1.4741,741.7315
-1.4382,745.2283
-1.4024,746.8607
-1.3666,748.962
-1.3307,755.7764
-1.2949,756.7242
-1.2591,757.6744
-1.2232,757.4366
-1.1874,757.6744
-1.1516,757.6744
-1.1157,757.6744
-1.0799,757.6744
-1.0441,765.143
-1.0082,769.8362
-0.97239,773.1105
-0.93655,781.6651
-0.90072,780.825
-0.86489,774.8997
-0.82905,775.4186
-0.79322,774.6419
-0.75738,771.089
-0.72155,769.5866
-0.68572,767.8476
-0.64988,767.8476
-0.61405,767.1067
-0.57821,764.6547
-0.54238,762.2276
-0.50655,761.9861
-0.47071,761.0225
-0.43488,762.2276
-0.39905,765.143
-0.36321,767.6004
-0.32738,768.343
-0.29154,775.4186
-0.25571,767.6004
-0.21988,767.3534
-0.18404,767.3534
-0.14821,767.3534
-0.11237,766.1227
-0.07654,767.3534
-0.040706,767.8476
-0.0048717,765.8774
0.030962,765.6324
0.066796,767.8476
0.10263,765.8774
0.13846,765.6324
0.1743,766.1227
0.21013,768.343
0.24597,769.8362
0.2818,770.8378
0.31763,770.8378
0.35347,770.8378
0.3893,770.8378
0.42514,772.6031
0.46097,773.6193
0.4968,774.3852
0.53264,774.3852
0.56847,777.8057
0.60431,774.3852
0.64014,774.6419
0.67597,774.3852
0.71181,775.4186
0.74764,775.9419
0.78348,777.8057
0.81931,772.0971
0.85514,771.8446
0.89098,767.8476
0.92681,765.143
0.96265,762.9533
0.99848,758.6274
1.0343,758.6274
1.0701,762.9533
1.106,761.5039
1.1418,761.5039
1.1776,770.3364
1.2135,771.089
1.2493,771.3406
1.2852,771.3406
1.321,764.4109
1.3568,764.4109
1.3927,764.8987
1.4285,768.0952
1.4643,766.8603
1.5002,766.8603
1.536,763.4382
1.5718,761.0225
1.6077,757.6744
1.6435,758.866
1.6793,762.9533
1.7152,763.9241
1.751,763.4382
1.7868,760.7821
1.8227,756.487
1.8585,750.5996
1.8943,748.7283
1.9302,745.9278
1.966,740.3314
2.0018,733.5298
2.0377,733.5298
2.0735,729.7349
2.1093,718.7045
2.1452,712.1577
2.181,709.6366
2.2168,706.6223
2.2527,702.8875
2.2885,693.2633
2.3243,687.2001
2.3602,684.8646
2.396,681.033
2.4318,680.642
2.4677,671.1186
2.5035,662.4598
2.5393,658.9229
2.5752,652.6626
2.611,646.0463
2.6468,639.1677
2.6827,630.6001
2.7185,625.2847
2.7543,610.1483
2.7902,602.8514
2.826,594.5371
2.8618,592.2454
2.8977,579.5465
2.9335,574.2864
2.9693,566.7734
3.0052,557.8158
3.041,543.6371
3.0768,526.959
3.1127,499.3823
3.1485,473.2187
3.1844,445.4076
3.2202,419.2083
3.256,386.8561
3.2919,355.0243
3.3277,299.3224
3.3635,277.2348
3.3994,237.9795
3.4352,8.611
3.471,0
3.5069,0
3.5427,0
3.5785,0
3.6144,0
3.6502,0
3.686,0
3.7219,0
3.7577,0
3.7935,0
3.8294,0
3.8652,0
3.901,0



"""


p1datos = """


-4.014,0
-3.9782,0
-3.9424,0
-3.9065,0
-3.8707,0
-3.8349,0
-3.799,0
-3.7632,0
-3.7274,0
-3.6915,0
-3.6557,0
-3.6199,0
-3.584,0
-3.5482,0
-3.5123,0.11052
-3.4765,198.0953
-3.4407,225.4927
-3.4048,267.3476
-3.369,297.8655
-3.3332,327.8708
-3.2973,352.8044
-3.2615,385.0605
-3.2257,418.0276
-3.1898,442.25
-3.154,459.2136
-3.1182,485.1749
-3.0823,505.4267
-3.0465,521.3419
-3.0107,542.3237
-2.9748,551.2717
-2.939,559.6236
-2.9032,565.5114
-2.8673,570.4436
-2.8315,575.6722
-2.7957,586.1536
-2.7598,589.4615
-2.724,596.9942
-2.6882,611.9516
-2.6523,616.3069
-2.6165,631.6688
-2.5807,640.444
-2.5448,644.1592
-2.509,648.3999
-2.4732,653.1478
-2.4373,656.2021
-2.4015,657.8026
-2.3657,661.4913
-2.3298,667.716
-2.294,671.6392
-2.2582,674.8295
-2.2223,680.2531
-2.1865,681.6235
-2.1507,684.243
-2.1148,687.8516
-2.079,692.1089
-2.0432,695.1363
-2.0073,697.5182
-1.9715,695.1363
-1.9357,697.2782
-1.8998,700.4277
-1.864,707.1234
-1.8282,707.8762
-1.7923,709.8884
-1.7565,707.8762
-1.7207,712.1577
-1.6848,712.1577
-1.649,712.41
-1.6131,714.6805
-1.5773,715.9405
-1.5415,715.9405
-1.5056,721.4504
-1.4698,722.6903
-1.434,727.5791
-1.3981,732.348
-1.3623,734.7083
-1.3265,739.3972
-1.2906,742.6642
-1.2548,744.7621
-1.219,745.2283
-1.1831,745.9278
-1.1473,745.9278
-1.1115,746.8607
-1.0756,747.3273
-1.0398,747.3273
-1.004,749.4295
-0.96814,751.3026
-0.9323,756.9615
-0.89647,758.3889
-0.86064,768.0952
-0.8248,773.8743
-0.78897,774.6419
-0.75313,775.4186
-0.7173,775.4186
-0.68147,772.6031
-0.64563,771.5924
-0.6098,772.6031
-0.57396,774.3852
-0.53813,778.8917
-0.5023,782.795
-0.46646,784.5083
-0.43063,784.5083
-0.39479,785.9508
-0.35896,785.0838
-0.32313,786.2407
-0.28729,784.5083
-0.25146,785.9508
-0.21563,783.9349
-0.17979,785.6613
-0.14396,785.6613
-0.10812,785.9508
-0.072289,783.079
-0.036455,788.2809
-0.0006215,788.2809
0.035212,781.6651
0.071046,781.6651
0.10688,786.8217
0.14271,785.3723
0.17855,784.5083
0.21438,784.5083
0.25022,785.6613
0.28605,785.6613
0.32188,785.6613
0.35772,786.531
0.39355,783.9349
0.42939,781.3844
0.46522,781.3844
0.50105,782.795
0.53689,784.5083
0.57272,784.5083
0.60856,791.5153
0.64439,792.4009
0.68022,793.8781
0.71606,793.8781
0.75189,797.712
0.78773,798.8854
0.82356,803.2337
0.85939,803.8053
0.89523,803.8053
0.93106,803.8053
0.9669,800.0539
1.0027,804.0902
1.0386,804.0902
1.0744,810.4412
1.1102,808.8269
1.1461,813.5584
1.1819,816.9746
1.2177,816.9746
1.2536,810.9715
1.2894,814.8079
1.3252,818.1287
1.3611,820.3206
1.3969,817.9009
1.4327,820.9459
1.4686,820.3206
1.5044,817.2083
1.5402,817.2083
1.5761,817.2083
1.6119,817.2083
1.6477,817.2083
1.6836,814.0619
1.7194,804.6582
1.7552,804.6582
1.7911,803.5198
1.8269,798.2992
1.8627,791.5153
1.8986,785.3723
1.9344,779.1655
1.9702,776.7347
2.0061,776.2051
2.0419,772.0971
2.0777,764.4109
2.1136,760.7821
2.1494,753.8875
2.1852,750.3654
2.2211,745.4615
2.2569,736.1188
2.2928,731.8743
2.3286,726.126
2.3644,722.6903
2.4003,715.6887
2.4361,707.1234
2.4719,697.0385
2.5078,693.7286
2.5436,681.4262
2.5794,671.988
2.6153,669.4033
2.6511,662.9455
2.6869,660.5262
2.7228,656.6824
2.7586,646.7239
2.7944,629.0789
2.8303,619.0829
2.8661,597.518
2.9019,583.831
2.9378,578.2137
2.9736,563.6735
3.0094,549.7727
3.0453,527.1787
3.0811,503.4648
3.1169,469.597
3.1528,444.0878
3.1886,418.0276
3.2244,389.3947
3.2603,326.2195
3.2961,300.935
3.3319,269.8065
3.3678,244.9214
3.4036,29.4389
3.4394,0
3.4753,0
3.5111,0
3.5469,0
3.5828,0
3.6186,0
3.6544,0
3.6903,0
3.7261,0
3.7619,0
3.7978,0
3.8336,0
3.8694,0
3.9053,0
3.9411,0
3.9769,0
4.0128,0


"""


p0datos = """

-4.0794,0
-4.0436,0
-4.0078,0
-3.9719,0
-3.9361,0
-3.9003,0
-3.8644,0
-3.8286,0
-3.7928,0
-3.7569,0
-3.7211,0
-3.6853,0
-3.6494,0
-3.6136,0
-3.5778,0
-3.5419,0
-3.5061,0
-3.4703,212.2065
-3.4344,244.4309
-3.3986,281.1543
-3.3627,302.5331
-3.3269,329.1474
-3.2911,367.9115
-3.2552,395.1234
-3.2194,420.4396
-3.1836,436.0635
-3.1477,456.4884
-3.1119,476.4061
-3.0761,494.6937
-3.0402,508.8638
-3.0044,517.386
-2.9686,526.8491
-2.9327,540.8912
-2.8969,545.5252
-2.8611,551.7884
-2.8252,561.3263
-2.7894,565.9553
-2.7536,572.8604
-2.7177,577.3795
-2.6819,582.56
-2.6461,587.5405
-2.6102,592.2454
-2.5744,601.4494
-2.5386,602.8514
-2.5027,610.3724
-2.4669,613.7756
-2.4311,614.2342
-2.3952,617.4628
-2.3594,623.2334
-2.3236,631.0295
-2.2877,635.9597
-2.2519,640.8049
-2.2161,641.1643
-2.1802,642.0559
-2.1444,643.2888
-2.1086,643.2888
-2.0727,643.2888
-2.0369,643.2888
-2.0011,647.2293
-1.9652,648.3999
-1.9294,649.8891
-1.8936,652.3385
-1.8577,652.5006
-1.8219,653.1478
-1.7861,656.8425
-1.7502,658.1226
-1.7144,658.7628
-1.6786,661.9751
-1.6427,662.2981
-1.6069,662.2981
-1.5711,662.7834
-1.5352,664.2467
-1.4994,663.4324
-1.4636,661.4913
-1.4277,661.4913
-1.3919,661.4913
-1.356,661.4913
-1.3202,665.7228
-1.2844,670.7731
-1.2485,671.988
-1.2127,671.2918
-1.1769,671.6392
-1.141,671.988
-1.1052,675.0104
-1.0694,671.8135
-1.0335,671.8135
-0.99771,669.9147
-0.96187,668.8943
-0.92604,668.8943
-0.89021,671.4654
-0.85437,673.5746
-0.81854,675.5553
-0.78271,675.5553
-0.74687,675.5553
-0.71104,675.3733
-0.6752,672.6896
-0.63937,671.8135
-0.60354,668.2195
-0.5677,667.0481
-0.53187,666.7155
-0.49603,667.8836
-0.4602,670.7731
-0.42437,670.9457
-0.38853,672.1629
-0.3527,673.0425
-0.31686,676.4721
-0.28103,676.4721
-0.2452,676.8418
-0.20936,677.5866
-0.17353,681.033
-0.13769,682.0199
-0.10186,681.2293
-0.066026,684.243
-0.030192,685.2827
0.0056419,684.243
0.041476,682.8193
0.07731,685.2827
0.11314,685.2827
0.14898,685.9155
0.18481,686.9843
0.22065,693.4957
0.25648,692.7999
0.29231,692.7999
0.32815,692.7999
0.36398,693.4957
0.39982,693.4957
0.43565,695.1363
0.47148,695.6093
0.50732,696.5604
0.54315,699.4523
0.57899,702.8875
0.61482,705.123
0.65065,708.63
0.68649,718.203
0.72232,723.4312
0.75815,725.6389
0.79399,728.5403
0.82982,728.5403
0.86566,728.5403
0.90149,725.1504
0.93732,725.1504
0.97316,725.1504
1.009,725.1504
1.0448,725.1504
1.0807,724.9057
1.1165,724.9057
1.1523,724.9057
1.1882,727.3378
1.224,727.3378
1.2598,728.3006
1.2957,723.1845
1.3315,722.195
1.3673,718.7045
1.4032,711.1487
1.439,710.3924
1.4748,707.3742
1.5107,706.372
1.5465,705.123
1.5823,701.6541
1.6182,699.9394
1.654,698.7243
1.6898,692.5691
1.7257,688.2893
1.7615,686.1278
1.7973,685.7038
1.8332,685.7038
1.869,685.4929
1.9048,685.4929
1.9407,681.2293
1.9765,675.9208
2.0123,670.7731
2.0482,667.716
2.084,663.9205
2.1198,660.5262
2.1557,659.2432
2.1915,661.3303
2.2273,666.2182
2.2632,666.5495
2.299,667.5487
2.3348,666.5495
2.3707,664.7371
2.4065,661.3303
2.4424,656.2021
2.4782,648.0666
2.514,645.193
2.5499,639.1677
2.5857,630.6001
2.6215,610.3724
2.6574,589.8311
2.6932,581.0252
2.729,575.3215
2.7649,567.6737
2.8007,561.3999
2.8365,557.2034
2.8724,551.9593
2.9082,538.5011
2.944,519.0314
2.9799,495.0298
3.0157,488.9739
3.0515,468.5842
3.0874,452.1719
3.1232,441.9812
3.159,427.0483
3.1949,408.8006
3.2307,385.3049
3.2665,358.3042
3.3024,330.3932
3.3382,307.712
3.374,288.7226
3.4099,254.2761
3.4457,213.6636
3.4815,0
3.5174,0
3.5532,0
3.589,0
3.6249,0
3.6607,0
3.6965,0
3.7324,0
3.7682,0
3.804,0
3.8399,0
3.8757,0
3.9115,0

"""

# Usamos StringIO para simular un archivo CSV a partir de las cadenas de datos
data_p4 = pd.read_csv(StringIO(p4datos), header=None, names=["posicion", "dosis"])
data_p3 = pd.read_csv(StringIO(p3datos), header=None, names=["posicion", "dosis"])
data_p2 = pd.read_csv(StringIO(p2datos), header=None, names=["posicion", "dosis"])
data_p1 = pd.read_csv(StringIO(p1datos), header=None, names=["posicion", "dosis"])
data_p0 = pd.read_csv(StringIO(p0datos), header=None, names=["posicion", "dosis"])

plt.figure(figsize=(10, 6))

plt.plot(data_p4['posicion'], data_p4['dosis'], label='p = 4 cm')
plt.plot(data_p3['posicion'], data_p3['dosis'], label='p = 3 cm')
plt.plot(data_p2['posicion'], data_p2['dosis'], label='p = 2 cm')
plt.plot(data_p1['posicion'], data_p1['dosis'], label='p = 1 cm')
plt.plot(data_p0['posicion'], data_p0['dosis'], label='p = 0 cm')

plt.xlabel('Distancia fuera del eje [cm]')
plt.ylabel('Dosis [cGy]')
plt.title('9 MeV, aplicador 10 cm, 0° ')
plt.grid()
plt.legend()

plt.show()

plt.plot(data_p4['posicion'], data_p4['dosis'], label='p = 4 cm')

# Implementar análisis para cada perfil de profundidad

profundidades = [data_p4, data_p3, data_p2, data_p1, data_p0]
resultados_fwhm = []
resultados_simetria_planitud = []

for i, data in enumerate(profundidades):
    posicion = data['posicion'].values
    dosis = data['dosis'].values

    # FWHM
    fwhm = calcular_fwhm(posicion, dosis)
    if fwhm is not None:
        print(f'FWHM para p = {4-i} cm: {fwhm:.2f} cm')
    else:
        print(f'FWHM no se pudo calcular para p = {4-i} cm')
    resultados_fwhm.append(fwhm)

    # Simetría y planitud
    simetria, planitud = calcular_simetria_planitud(posicion, dosis)
    if planitud is not None:
        print(f'Simetría para p = {4-i} cm: {simetria:.2f}%')
        print(f'Planitud para p = {4-i} cm: {planitud:.2f}%')
    else:
        print(f'Planitud no se pudo calcular para p = {4-i} cm')

    resultados_simetria_planitud.append((simetria, planitud))

# Visualizar los resultados
print("\nResultados FWHM (Ancho del Haz a la Mitad de la Dosis):", resultados_fwhm)
print("\nResultados de Simetría y Planitud (en porcentaje):", resultados_simetria_planitud)

# Función para calcular FWHM (Full Width Half Maximum)
def calcular_fwhm(posicion, dosis):
    max_dosis = max(dosis)
    half_max_dosis = max_dosis / 2

    # Buscar las posiciones donde la dosis es mayor o igual al 50% de la dosis máxima
    posiciones_half_max = np.where(dosis >= half_max_dosis)[0]

    if len(posiciones_half_max) > 1:
        fwhm_start = posicion[posiciones_half_max[0]]  # Primera posición donde se alcanza el 50%
        fwhm_end = posicion[posiciones_half_max[-1]]  # Última posición donde se alcanza el 50%
        fwhm = abs(fwhm_end - fwhm_start)
        return fwhm, fwhm_start, fwhm_end
    else:
        # Si no se puede calcular el FWHM, devuelve None para los tres valores
        return None, None, None

# Función corregida para calcular la simetría y planitud
def calcular_simetria_planitud(posicion, dosis):
    # Simetría: Compara la dosis a ambos lados del eje central (posicion 0)
    indice_central = np.argmin(np.abs(posicion))  # Encuentra el índice más cercano a 0 (eje central)
    dosis_central = dosis[indice_central]

    izquierda = dosis[:indice_central]
    derecha = dosis[indice_central+1:][::-1]  # Invertir la parte derecha para comparar con la izquierda

    # Asegurarnos de que las dos partes tengan la misma longitud
    if len(izquierda) > len(derecha):
        izquierda = izquierda[:len(derecha)]
    elif len(derecha) > len(izquierda):
        derecha = derecha[:len(izquierda)]

    simetria = np.mean(np.abs(izquierda - derecha) / dosis_central) * 100  # Error relativo porcentual

    # Planitud: Variación dentro del área entre el 80% y 100% de la dosis máxima
    max_dosis = max(dosis)
    limite_inferior = 0.8 * max_dosis

    # Filtrar la región de interés (dosis >= 80% de la dosis máxima)
    indices_region = np.where(dosis >= limite_inferior)[0]

    if len(indices_region) > 0:
        dosis_region = dosis[indices_region]
        max_region = max(dosis_region)
        min_region = min(dosis_region)
        planitud = (max_region - min_region) / (max_region + min_region) * 100
    else:
        planitud = None
        limite_inferior = None
        indices_region = None

    return simetria, planitud, limite_inferior, indices_region

# Implementar análisis para cada perfil de profundidad
profundidades = [data_p4, data_p3, data_p2, data_p1, data_p0]
etiquetas = ['p = 4 cm', 'p = 3 cm', 'p = 2 cm', 'p = 1 cm', 'p = 0 cm']
colores = ['b', 'g', 'r', 'orange', 'purple']

# Generar gráficos individuales para cada curva
for i, data in enumerate(profundidades):
    posicion = data['posicion'].values
    dosis = data['dosis'].values

    # FWHM
    fwhm, fwhm_start, fwhm_end = calcular_fwhm(posicion, dosis)

    # Simetría y planitud
    simetria, planitud, limite_inferior, indices_region = calcular_simetria_planitud(posicion, dosis)

    # Crear un gráfico individual para cada perfil
    plt.figure(figsize=(10, 6))

    # Graficar el perfil
    plt.plot(posicion, dosis, label=etiquetas[i], color=colores[i])

    # Añadir líneas de FWHM en la gráfica (con opacidad baja)
    if fwhm is not None:
        plt.axvline(fwhm_start, color=colores[i], linestyle='--', alpha=0.5, label=f'FWHM: {fwhm:.2f} cm')
        plt.axvline(fwhm_end, color=colores[i], linestyle='--', alpha=0.5)

    # Añadir la región de 80% a 100% de la dosis máxima (planitud)
    if indices_region is not None:
        plt.fill_between(posicion[indices_region], dosis[indices_region], color=colores[i], alpha=0.15, label='Planitud')

    # Imprimir los resultados
    if fwhm is not None:
        print(f'FWHM para {etiquetas[i]}: {fwhm:.2f} cm')
    print(f'Simetría para {etiquetas[i]}: {simetria:.2f}%')
    if planitud is not None:
        print(f'Planitud para {etiquetas[i]}: {planitud:.2f}%')

    # Configuración de la gráfica
    plt.xlabel('Distancia fuera del eje [cm]')
    plt.ylabel('Dosis [cGy]')
    plt.title(f'Análisis de Perfil de Radiación para {etiquetas[i]}')
    plt.grid()

    # Ajustar la leyenda para ser más clara
    plt.legend(loc='upper right', fontsize='small')

    # Mostrar la gráfica individual
    plt.show()

import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from scipy.interpolate import interp1d

# Función corregida para calcular FWHM
def calcular_fwhm(posicion, dosis):
    max_dosis = max(dosis)
    half_max_dosis = max_dosis / 2

    posiciones_half_max = np.where(dosis >= half_max_dosis)[0]

    if len(posiciones_half_max) > 1:
        fwhm_start = posicion[posiciones_half_max[0]]  # Primera posición donde se alcanza el 50%
        fwhm_end = posicion[posiciones_half_max[-1]]  # Última posición donde se alcanza el 50%
        fwhm = abs(fwhm_end - fwhm_start)
        return fwhm, fwhm_start, fwhm_end
    else:
        return None, None, None

# Función corregida para calcular la simetría y planitud
def calcular_simetria_planitud(posicion, dosis):
    indice_central = np.argmin(np.abs(posicion))  # Encuentra el índice más cercano a 0 (eje central)
    dosis_central = dosis[indice_central]

    izquierda = dosis[:indice_central]
    derecha = dosis[indice_central+1:][::-1]  # Invertir la parte derecha para comparar con la izquierda

    if len(izquierda) > len(derecha):
        izquierda = izquierda[:len(derecha)]
    elif len(derecha) > len(izquierda):
        derecha = derecha[:len(izquierda)]

    simetria = np.mean(np.abs(izquierda - derecha) / dosis_central) * 100  # Error relativo porcentual

    # Planitud: Variación dentro del área entre el 80% y 100% de la dosis máxima
    max_dosis = max(dosis)
    limite_inferior = 0.8 * max_dosis

    # Filtrar la región de interés (dosis >= 80% de la dosis máxima)
    indices_region = np.where(dosis >= limite_inferior)[0]

    if len(indices_region) > 0:
        dosis_region = dosis[indices_region]
        max_region = max(dosis_region)
        min_region = min(dosis_region)
        planitud = (max_region - min_region) / (max_region + min_region) * 100
    else:
        planitud = None

    return simetria, planitud

# Implementar análisis para cada perfil de profundidad
profundidades = [data_p4, data_p3, data_p2, data_p1, data_p0]
etiquetas = ['p = 4 cm', 'p = 3 cm', 'p = 2 cm', 'p = 1 cm', 'p = 0 cm']

# Crear una lista para almacenar los resultados
resultados = []

# Realizar el análisis para cada perfil
for i, data in enumerate(profundidades):
    posicion = data['posicion'].values
    dosis = data['dosis'].values

    # Calcular FWHM
    fwhm, _, _ = calcular_fwhm(posicion, dosis)

    # Calcular simetría y planitud
    simetria, planitud = calcular_simetria_planitud(posicion, dosis)

    # Agregar los resultados a la lista
    resultados.append({
        'Profundidad': etiquetas[i],
        'FWHM (cm)': fwhm if fwhm is not None else 'N/A',
        'Simetría (%)': simetria if simetria is not None else 'N/A',
        'Planitud (%)': planitud if planitud is not None else 'N/A'
    })

# Convertir los resultados a un DataFrame de pandas para generar la tabla
df_resultados = pd.DataFrame(resultados)

# Mostrar la tabla
print(df_resultados)

# Opcional: Guardar la tabla en un archivo Excel o CSV
df_resultados.to_csv('resumen_analisis_radiacion.csv', index=False)
# df_resultados.to_excel('resumen_analisis_radiacion.xlsx', index=False)